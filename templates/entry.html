{% extends "base.html" %}

{% block title %}{{ e.entry_title|lower }}{% endblock %}

{% block head %}
<!-- load the jQuery and require.js libraries -->
<script type="text/javascript" src="/and/scripts/being/aloha/lib/require.js"></script>
<script type="text/javascript" src="/and/scripts/being/aloha/lib/vendor/jquery-1.7.2.js"></script>

<!-- load the Aloha Editor core and some plugins -->
<script src="/and/scripts/being/aloha/lib/aloha.js"
                   data-aloha-plugins="common/ui,
                                        common/format,
                                        common/list,
                                        common/link,
                                        common/highlighteditables,
                                        extra/sourceview">
</script>

<!-- load the Aloha Editor CSS styles -->
<link href="/and/scripts/being/aloha/css/aloha.css" rel="stylesheet" type="text/css" />
 
<!-- make all elements with class="editable" editable with Aloha Editor -->
<script type="text/javascript">
    Aloha.ready( function() {
        var $ = Aloha.jQuery;

        $('article').aloha();
        Aloha.bind('aloha-smart-content-changed', function(jQueryEvent, eventArgument) {
            console.log(jQueryEvent, eventArgument)

            var e = eventArgument.editable;
            var entryId = e.obj.attr('id').replace('entry-','');
            var postData = { 
                'entry_text' : Aloha.activeEditable.getContents() }

            console.log(JSON.stringify(postData))

            var request = jQuery.ajax({
                url: "/api/entry/" + entryId + "/",
                type: "PATCH",
                data: JSON.stringify(postData),
                dataType: "json",
                contentType: "application/json",
                processData: false,
                error: function(xhr, status, error) {
                    console.log("error!");
                    console.log(xhr, status, error);
                    },
                });

            });
     });
</script>
<link rel="stylesheet" href="/and/style/in/{{ a.author_name}}.css" type="text/css" />
{% endblock %}

{% block content %}
<div class="grid_1">
  
  <img src="{{ a_thumbnail_url }}" style="width:100px;height:100px;" alt="" />
  
  <h4 class="author">{{ a.author_nickname }}</h4>
  <p>&nbsp;</p>
  
  <hr />
  
  <h4>Articles</h4>
  <dl>
  {% for e in a_entries %}
  <dt><a href="/or/{{ e.entry_basename }}">{{ e.entry_title }}</a></dt>
  <dd>{{ e.entry_authored_on|date:"F j, Y f A" }}</dd>
  {% endfor %}
  </dl>

  <h4>Comments</h4>
  <dl>
  {% for c in a_comments %}
    <dt>{{ c.comment_author }} on <a href ="/or/">Title of entry</a></dt>
    <dd>{{ c.comment_created_on|date:"F j, Y f A" }}</dd>
  {% endfor %}
  </dl>
  <hr />
  
  <h4>Other writers</h4>
  <ul>
  {% for a in authors %}
    <li>{{ a.author_nickname }}</li>
  {% endfor %}
  </ul>
    
</div>
<div class="grid_5 post">
  <p class="byline">
  {% if e.previous %}<a href="/or/{{ e.previous.entry_basename }}">Previous</a>{% endif %}
  {% if e.next %}  / <a href="/or/{{ e.next.entry_basename }}">Next</a>{% endif %}
  </p>
  <div>
    <div class="article grid_3 alpha omega suffix_2">
    <h4>{{ e.entry_title }}</h4>
    <article id="entry-{{ e.entry_id }}">
    {{ e.entry_text|safe }}
    </article>
    <h4 class="comments-header">{% if e_comments %}{{ e_comments.count }} Comments{% else %}No Comments{% endif %}</h4>

    <div class="comments-content">
      {% include "comment.html" %}
    </div>


    </div>
  </div>
  <hr />

</div>

<div class="grid_1">
  <h4>Latest articles</h4>
  <dl>
  {% for e in recent_entries %}
  <dt><a href="/or/{{ e.entry_basename }}">{{ e.entry_title }}</a></dt>
  <dd>{{ e.entry_authored_on|date:"F j, Y f A" }}</dd>
  {% endfor %}
  </dl>


  <h4>Latest Comments</h4>
  <ul>
  {% for c in recent_comments %}
    <li><strong>{{ c.comment_author }}:</strong> {{ c.comment_text|striptags|truncatewords:10 }} <a href="/or/" title="full comment on: Title of entry">read more</a></li>
  {% endfor %}
  </ul>

</div>
{% endblock %}

